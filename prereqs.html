<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Assumed Python knowledge &mdash; BMI3D 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="BMI3D 1.0 documentation" href="index.html" />
    <link rel="next" title="Tasks" href="tasks.html" />
    <link rel="prev" title="Installation" href="install.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="tasks.html" title="Tasks"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="install.html" title="Installation"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">BMI3D 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="assumed-python-knowledge">
<h1>Assumed Python knowledge<a class="headerlink" href="#assumed-python-knowledge" title="Permalink to this headline">¶</a></h1>
<p>In order to use this library well, it is assumed that you are pretty familiar with Python. For example, some of the medium concepts you should at least recognize include</p>
<blockquote>
<div><ul class="simple">
<li>numpy/scipy</li>
<li>how to make a python module</li>
<li>&#8220;New&#8221; style inheritance and object-oriented programming in Python</li>
<li>iterators and generators</li>
</ul>
</div></blockquote>
<p>As with any software package in development, reading error messages and subsequent use of googling relevant portions of the message cannot be avoided.</p>
<p>A deep understanding of the core functionality of this library requires knowledge of a few concepts which are not typically found in brief introductions to Python and which are uncommon in scientific data analyses. Once your experiment is all set up and debugged, it&#8217;s certainly possible for the experimenter to not need to know what&#8217;s under the hood. However, depending on how complicated your experiment setup is, you may want to spend some time learning some of the other libraries/functionality that this library is built on top of.</p>
<div class="section" id="multiple-inheritance">
<h2>Multiple inheritance<a class="headerlink" href="#multiple-inheritance" title="Permalink to this headline">¶</a></h2>
<p>Multiple inheritance is a contentious topic, with large disagreement between various internet talking heads about whether it is necessary or should even exist. Your opinion on the matter is irrelevant. This library uses multiple inheritance and a metaclass constructor in order to embed user-selected &#8216;features&#8217; into &#8216;experiments&#8217; at runtime. There certainly are other implementation strategies which do not emply multiple inheritance, but what&#8217;s done is done. It would take much much less time to just learn multiple inheritance than it would to redo the library, and the effort would be pointless. Having an experimental setup where you can dynamically select or deselect large portions of functionality at runtime is going to be complicated no matter what you do.</p>
<p>That&#8217;s enough philosophy. As an obvious prerequisite to understanding multiple inheritance, you should understand single inheritance! This is a good introduction: <a class="reference external" href="http://learnpythonthehardway.org/book/ex44.html">http://learnpythonthehardway.org/book/ex44.html</a></p>
<p>This library uses new-style inheritance, where all classes inherit from the built-in type <tt class="docutils literal"><span class="pre">object</span></tt>. A key reason for inheritance to exist is so that children can choose to either call, modfiy, or override their parent&#8217;s methods. In classes inheriting from <tt class="docutils literal"><span class="pre">object</span></tt>, the &#8220;parent&#8217;s&#8221; attributes are accessed by use of the <tt class="docutils literal"><span class="pre">super</span></tt> function.</p>
<p><tt class="docutils literal"><span class="pre">super</span></tt> lets you get your parent&#8217;s methods without knowing the name of your parent, which may be nice if you ever change the inheritance tree. (In Python 2, you still have to refer to your own class name, so annoying things can happen if you change the name of the child class or copy-paste what should be straightforward code from another class).</p>
<p>With multiple inheritance, there is not a single &#8220;parent&#8221; (hence the quotes). Python instead creates a &#8220;method resolution order&#8221; (MRO), a unique ordering of the parents methods to go through one at a time. When you call <tt class="docutils literal"><span class="pre">super</span></tt>, you&#8217;re really just asking for the next method in the MRO, rather than an explicit parent. The object will not be constructed if a consistent MRO cannot be defined.</p>
<p>This is a fairly advanced description of what <tt class="docutils literal"><span class="pre">super</span></tt> can do: <a class="reference external" href="https://rhettinger.wordpress.com/2011/05/26/super-considered-super/">https://rhettinger.wordpress.com/2011/05/26/super-considered-super/</a>. It&#8217;s written for Python 3 rather than Python 2 (not backwards compatible) so it&#8217;s more for reading than trying.</p>
</div>
<div class="section" id="using-multiple-processes">
<h2>Using multiple processes<a class="headerlink" href="#using-multiple-processes" title="Permalink to this headline">¶</a></h2>
<p>In experiments with many peripheral devices, data must be acquired and logged asynchronously. In this library, the &#8216;multiprocessing&#8217; module is the main workhorse for enabling asynchronous input/output functionality. In particular, multiprocessing is used for the webserver to spawn tasks (<tt class="docutils literal"><span class="pre">db.tasktrack</span></tt>), for acquiring data from sources (<tt class="docutils literal"><span class="pre">riglib.source</span></tt>) and for any BMI computation which cannot complete in the relatively short event loop (<tt class="docutils literal"><span class="pre">riglib.mp_calc</span></tt>).</p>
<p>This is a decent introduction to multiprocessing: <a class="reference external" href="https://pymotw.com/2/multiprocessing/basics.html">https://pymotw.com/2/multiprocessing/basics.html</a></p>
<p>Here&#8217;s a simple python example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">multiprocessing</span> <span class="kn">as</span> <span class="nn">mp</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c">#### Version 1: single-threaded</span>
<span class="k">def</span> <span class="nf">target_fn</span><span class="p">():</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c"># simulate thinkin</span>
    <span class="k">print</span> <span class="s">&quot;TARGET FUNCTION: done computing answer&quot;</span>
    <span class="k">return</span> <span class="s">&quot;answer&quot;</span>

<span class="n">t_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="k">print</span> <span class="s">&quot;Single-process version&quot;</span>
<span class="n">target_fn</span><span class="p">()</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;fake event loop, index </span><span class="si">%d</span><span class="s">, time since start of loop: </span><span class="si">%g</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t_start</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot;</span><span class="se">\n\n\n\n\n\n</span><span class="s">&quot;</span>

<span class="c">#### Version 2: multi-threaded</span>
<span class="n">t_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="k">print</span> <span class="s">&quot;Multi-process version&quot;</span>
<span class="n">proc</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target_fn</span><span class="p">)</span>
<span class="n">proc</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;fake event loop, index </span><span class="si">%d</span><span class="s">, time since start of loop: </span><span class="si">%g</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t_start</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>


<span class="k">print</span> <span class="s">&quot;</span><span class="se">\n\n\n\n\n\n</span><span class="s">&quot;</span>

<span class="c">#### Version 3: multi-threaded, alternate implementation</span>
<span class="k">class</span> <span class="nc">TargetClass</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">Process</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">target_fn</span><span class="p">()</span>

<span class="n">t_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="k">print</span> <span class="s">&quot;Multi-process version&quot;</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">TargetClass</span><span class="p">()</span>
<span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;fake event loop, index </span><span class="si">%d</span><span class="s">, time since start of loop: </span><span class="si">%g</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t_start</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
<p>In the first single-threaded example, note that the whole loop is stalled until <tt class="docutils literal"><span class="pre">target_fn</span></tt> finishes running. In the multi-process version, the event loop runs at roughly the time one expects and <tt class="docutils literal"><span class="pre">target_fn</span></tt> emits its answer once it&#8217;s done, without stalling any of the other things that might be happening in the event loop.</p>
<p>The third version is actually the same as the second. It just looks a bit more object-oriented, but as you can tell from the output, it accomplishes the same functionality.</p>
<p>NOTE: similar functionality can be accompished with threads.</p>
</div>
<div class="section" id="database-integration-with-django">
<h2>Database integration with Django<a class="headerlink" href="#database-integration-with-django" title="Permalink to this headline">¶</a></h2>
<p>The ability of this library to do automatic data logging and file linking is a great feature of this library (and arguably, makes its complexity worthwhile). We recommend that you go through the introductory Django tutorial (<a class="reference external" href="https://docs.djangoproject.com/en/dev/intro/tutorial01/">https://docs.djangoproject.com/en/dev/intro/tutorial01/</a>), which shows you how to build a simple Django application fairly similar to what we do during the experiment logging (though with a less complicated user interface).</p>
</div>
</div>
<div class="section" id="helpful-python-hints">
<h1>Helpful python hints<a class="headerlink" href="#helpful-python-hints" title="Permalink to this headline">¶</a></h1>
<p>Some clues on the more tricky/magical aspects of the code</p>
<ul>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">getattr</span></tt> and <tt class="docutils literal"><span class="pre">setattr</span></tt></dt>
<dd><p class="first">If you have an object <tt class="docutils literal"><span class="pre">obj</span></tt> with attribute <tt class="docutils literal"><span class="pre">param</span></tt>, the two lines below are equivalent:</p>
<div class="highlight-python"><div class="highlight"><pre>In [3]: class TestClass(object):
   ...:     def __init__(self):
   ...:         self.param = &#39;value&#39;
   ...:

In [4]: obj = TestClass()

In [5]: obj.param
Out[5]: &#39;value&#39;

In [6]: getattr(obj, &#39;param&#39;)
Out[6]: &#39;value&#39;
</pre></div>
</div>
<p class="last">The second one allows you to get an attribute of an object by specifying a string name. This can be useful in selecting which attribute of the object you want on the fly.</p>
</dd>
</dl>
</li>
<li><p class="first">Making python modules</p>
<blockquote>
<div><p>Putting a <tt class="docutils literal"><span class="pre">__init__.py</span></tt> into a folder makes a module. Why is it sometimes necessary to make modules? Consider the following example:</p>
<div class="highlight-python"><div class="highlight"><pre>In [1]: pwd
Out[1]: u&#39;/Users/sgowda/code/bmi3d&#39;

In [2]: ls docs
...
create_docstring.py
...

In [3]: from docs import create_docstring
---------------------------------------------------------------------------
ImportError                               Traceback (most recent call last)
&lt;ipython-input-3-01a5608ea874&gt; in &lt;module&gt;()
----&gt; 1 from docs import create_docstring

ImportError: No module named docs
</pre></div>
</div>
<p>We tried to import the python file <tt class="docutils literal"><span class="pre">create_docstring.py</span></tt>, which <tt class="docutils literal"><span class="pre">ipython</span></tt> can clearly see, but the import doesn&#8217;t work! Putting an empty <tt class="docutils literal"><span class="pre">__init__.py</span></tt> in the docs directory tells python to treat the directory as a module and allows us to import a sub-module from inside the module.</p>
</div></blockquote>
</li>
<li><p class="first">Variable unpacking</p>
<blockquote>
<div><p>In the great &#8220;MATLAB vs Python&#8221; debate, one point clearly in the python column is its ability to deal with variable unpacking:</p>
<blockquote>
<div><p>In [1]: a, b, c = (1, 2, 3)</p>
<p>In [2]: a
Out[2]: 1</p>
<p>In [3]: b
Out[3]: 2</p>
<p>In [4]: c
Out[4]: 3</p>
</div></blockquote>
<p>This works in a variety of cases. For example, you can simultaneously iterate over two variables:</p>
<div class="highlight-python"><div class="highlight"><pre>In [5]: data = [(1, 10), (2, 20), (3, 30), (4, 40)]

In [6]: for x, y in data:
   ...:     print x + y
   ...:
11
22
33
44
</pre></div>
</div>
<p>This also works for multiple output arguments from a function:</p>
<div class="highlight-python"><div class="highlight"><pre>In [7]: def fn():
   ...:     return 1, 3, 4
   ...:

In [8]: resp = fn()

In [9]: resp
Out[9]: (1, 3, 4)

In [10]: a, b, c = fn()

In [11]: a
Out[11]: 1

In [12]: b
Out[12]: 3

In [13]: c
Out[13]: 4
</pre></div>
</div>
<p>One odd corner case to keep in mind is what happens when you return one argument but you try to return multiple arguments:</p>
<div class="highlight-python"><div class="highlight"><pre>In [14]: def fn2():
   ....:     return (1,)
   ....:

In [15]: resp = fn2()

In [16]: resp
Out[16]: (1,)

In [17]: a, = fn2() # note the comma!

In [18]: a
Out[18]: 1
</pre></div>
</div>
<p>Unlike in MATLAB, a length-1 object is NOT automatically demoted to a scalar in python</p>
</div></blockquote>
</li>
<li><p class="first">&#64;property decorator</p>
</li>
<li><p class="first">keyword arguments</p>
<blockquote>
<div><p>Keyword arguments in python are arguments which can be indexed by name. (Standard function call arguments are, by contrast, positional arguments). An example:</p>
<div class="highlight-python"><div class="highlight"><pre>In [2]: def fn(a=1, b=2):
   ...:         print a, b
   ...:

In [3]: fn()
1 2

In [4]: fn(a=3)
3 2

In [5]: fn(b=4)
1 4

In [6]: fn(b=3, a=6)
6 3
</pre></div>
</div>
<p>Keyword arguments let you specify function arguments in an order-independent manner, so you don&#8217;t have to remember the exact order of arguments all the time. In addition, they let you supply default values for arguments so not every function call needs to explicitly list out all the arguments, to avoid repetition. Sometimes it&#8217;s useful for a function to not specify an exhaustive list of keyword arguments it expects. For example:</p>
<div class="highlight-python"><div class="highlight"><pre>In [7]: def fn2(a=1, b=2, **kwargs):
   ...:     print a, b
   ...:     print kwargs
   ...:

In [8]: fn2(a=1, b=2, c=3)
1 2
{&#39;c&#39;: 3}
</pre></div>
</div>
<p>We gave an extra keyword argument <tt class="docutils literal"><span class="pre">c</span></tt> which was not used by the function. As shown by the output of the function call, this gets packed into a dictionary <tt class="docutils literal"><span class="pre">kwargs</span></tt>.</p>
<p>This can be useful if you want to just pass all the extra keyword arguments to another function, without needing to explicitly name them in the top-level function.</p>
</div></blockquote>
</li>
</ul>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Assumed Python knowledge</a><ul>
<li><a class="reference internal" href="#multiple-inheritance">Multiple inheritance</a></li>
<li><a class="reference internal" href="#using-multiple-processes">Using multiple processes</a></li>
<li><a class="reference internal" href="#database-integration-with-django">Database integration with Django</a></li>
</ul>
</li>
<li><a class="reference internal" href="#helpful-python-hints">Helpful python hints</a></li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="install.html"
                        title="previous chapter">Installation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="tasks.html"
                        title="next chapter">Tasks</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/prereqs.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="tasks.html" title="Tasks"
             >next</a> |</li>
        <li class="right" >
          <a href="install.html" title="Installation"
             >previous</a> |</li>
        <li><a href="index.html">BMI3D 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, James Gao; 2015, James Gao, Helene Moorman, Suraj Gowda, Siddharth Dangi.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>