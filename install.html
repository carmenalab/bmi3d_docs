<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Installation &mdash; BMI3D 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="BMI3D 1.0 documentation" href="index.html" />
    <link rel="next" title="Assumed Python knowledge" href="prereqs.html" />
    <link rel="prev" title="Welcome to BMI3D’s documentation!" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="prereqs.html" title="Assumed Python knowledge"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to BMI3D’s documentation!"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">BMI3D 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="installation">
<h1>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h1>
<p>This document describes how to set up the BMI3D code for use in
neurophysiology experiments.</p>
<div class="section" id="downloading-the-software">
<h2>Downloading the software<a class="headerlink" href="#downloading-the-software" title="Permalink to this headline">¶</a></h2>
<p>The software should reside at the path $HOME/code/bmi3d, where $HOME is your home directory (this should be a variable already defined in your bash environment). If the bmi3d path does not already exist, create it by executing the commands:</p>
<div class="highlight-python"><div class="highlight"><pre>mkdir $HOME/code
cd $HOME/code
git clone https://github.com/carmenalab/brain-python-interface.git bmi3d
</pre></div>
</div>
<p>This will also clone the core software in the repository and put it in the appropriately named folder</p>
</div>
<div class="section" id="library-dependencies">
<h2>Library dependencies<a class="headerlink" href="#library-dependencies" title="Permalink to this headline">¶</a></h2>
<p>Many of the commands to execute below are available in the file $BMI3D/install/install.sh. It&#8217;s highly recommended that you read through the instructions rather than blindly executing the script as every BMI rig will have its own slight differences</p>
</div>
<div class="section" id="directory-structure">
<h2>Directory structure<a class="headerlink" href="#directory-structure" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>We make several directories. The main BMI3D package code base will be installed to $HOME/code/bmi3d. But if you&#8217;re already reading these instructions from the git repository, you can change the installation location(s) if you want by modifying the environment variables::</dt>
<dd>CODE=$HOME/code
BMI3D=$HOME/code/bmi3d</dd>
</dl>
<p>We also make the directories /backup and /storage. /backup is the mount point for off-site data backup. /storage is where files created during the process of running experiments, e.g. HDF files containing BMI kinematics, will be stored. Most of the file handling in /storage is done through Django:</p>
<div class="highlight-python"><div class="highlight"><pre>mkdir -p $CODE
sudo mkdir /backup
sudo chown $USER /backup
# make log directory
mkdir $BMI3D/log
sudo mkdir /storage
sudo chown -R lab /storage
mkdir /storage/plots
</pre></div>
</div>
<p>We also make a directory to dump miscellaneous source code bases required to run the experiments:</p>
<div class="highlight-python"><div class="highlight"><pre>mkdir $CODE/src/
</pre></div>
</div>
</div>
<div class="section" id="configuring-the-ubuntu-package-manager">
<h2>Configuring the Ubuntu package manager<a class="headerlink" href="#configuring-the-ubuntu-package-manager" title="Permalink to this headline">¶</a></h2>
<p>We need apt-get to search for packages in a couple of repositories that are not managed by Ubuntu, so we have to add these manually. Specifically we need to add repositories for the RabbitMQ and Sublime Text packages (the second is optional):</p>
<div class="highlight-python"><div class="highlight"><pre>sudo apt-add-repository &quot;deb http://www.rabbitmq.com/debian/ testing main&quot;
cd $HOME
wget http://www.rabbitmq.com/rabbitmq-signing-key-public.asc
sudo apt-key add rabbitmq-signing-key-public.asc
sudo add-apt-repository ppa:webupd8team/sublime-text-2

## Refresh the package manager&#39;s list of available packages
sudo apt-get update
</pre></div>
</div>
</div>
<div class="section" id="install-apt-get-dependencies">
<h2>Install apt-get dependencies<a class="headerlink" href="#install-apt-get-dependencies" title="Permalink to this headline">¶</a></h2>
<p>We install all the apt-get dependencies at once. All the commands are given with the &#8220;-y&#8221; flag so that they install automatically, so read through the list if you need to be careful of collisions:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo apt-get -y install python-pip libhdf5-serial-dev
sudo apt-get -y install python-numpy
sudo apt-get -y install python-scipy
# setup the CIFS
sudo apt-get -y install smbclient cifs-utils smbfs
# matplotlib
sudo apt-get -y install python-matplotlib
# pygame
sudo apt-get -y install mercurial python-dev python-numpy ffmpeg libsdl-image1.2-dev libsdl-mixer1.2-dev libsdl-ttf2.0-dev libsmpeg-dev libsdl1.2-dev  libportmidi-dev libswscale-dev libavformat-dev libavcodec-dev
# install tools
sudo apt-get -y install libtool automake bison flex
# ssh
sudo apt-get -y install openssh-server
# text editors
sudo apt-get -y install sublime-text vim-gnome
sudo apt-get -y install rabbitmq-server
sudo apt-get -y install libusb-dev
sudo apt-get -y install ipython
# NIDAQ
sudo apt-get -y install libcomedi-dev
sudo apt-get -y install python-comedilib
sudo apt-get -y install swig
# DHCP server
sudo apt-get -y install isc-dhcp-server
</pre></div>
</div>
</div>
<div class="section" id="install-python-dependencies">
<h2>Install Python dependencies<a class="headerlink" href="#install-python-dependencies" title="Permalink to this headline">¶</a></h2>
<p>For the remainder of the Python dependencies, we use the python package-manager &#8220;pip&#8221;. This makes the installation procedure marginally less platform dependent. Many of these packages will be necessary if you want to take full advantage of the BMI3D software for the purpose of analyzing data:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo pip install numexpr
sudo pip install cython
sudo pip install django-celery
sudo pip install traits
sudo pip install pandas
sudo pip install patsy
sudo pip install statsmodels
sudo pip install PyOpenGL PyOpenGL_accelerate
sudo pip install Django==1.6
sudo pip install pylibftdi
sudo pip install nitime
sudo pip install sphinx
sudo pip install numpydoc
sudo pip install tornado
sudo pip install tables
</pre></div>
</div>
</div>
<div class="section" id="additional-source-code">
<h2>Additional source code<a class="headerlink" href="#additional-source-code" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>Suraj&#8217;s matplotlib code. Obviously optional::</dt>
<dd>git clone <a class="reference external" href="https://github.com/sgowda/plot">https://github.com/sgowda/plot</a> $HOME/code/plotutil</dd>
<dt>Robotics toolbox. Necessary prerequisite due to import statements, but can be removed if your experiment does not use any of the kinematic chain functionality built in (and you remove the appropriate import statements)::</dt>
<dd>git clone <a class="reference external" href="https://github.com/sgowda/robotics_toolbox">https://github.com/sgowda/robotics_toolbox</a> $HOME/code/robotics</dd>
<dt>All the graphics run through pygame::</dt>
<dd>hg clone <a class="reference external" href="https://bitbucket.org/pygame/pygame">https://bitbucket.org/pygame/pygame</a> $HOME/code/pygame</dd>
</dl>
<p>See install.sh for the detailed commands to install each of these packages</p>
</div>
<div class="section" id="udev-and-groups">
<h2>udev and groups<a class="headerlink" href="#udev-and-groups" title="Permalink to this headline">¶</a></h2>
<p>udev rules are necessary for any user to interact with the Phidgets board (optional) and the NIDAQ card. In addition, to allow the BMI3D software to be run as a regular user but still interact with various hardware devices/serial ports, it is necessary to add the experimenter user (&#8216;lab&#8217;, in our case) to the &#8216;dialout&#8217; group ()for serial port access) and the &#8216;iocard&#8217; group (NIDAQ board access).</p>
</div>
<div class="section" id="path-configuration">
<h2>Path configuration<a class="headerlink" href="#path-configuration" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>After all the packages have been installed through their various mechanisms (apt-get, pip, source, etc.), we must add the appropriate BMI3D folders to the system&#8217;s python path. At the top of the BMI3D folder lives a file called &#8216;pathconfig.sh&#8217;. If you &#8216;source&#8217; this script, it will make the appropriate modifications to the PYTHONPATH. To avoid having to source this constantly, add a line to the .bashrc file so that it gets sourced every time you open a new shell::</dt>
<dd>sed -i &#8216;$a source $HOME/code/bmi3d/pathconfig.sh&#8217; $HOME/.bashrc</dd>
<dt>We also need to make sure the robotics toolbox is on the PYTHONPATH::</dt>
<dd>sed -i &#8216;$a export PYTHONPATH=$PYTHONPATH:$HOME/code/robotics&#8217; $HOME/.bashrc</dd>
</dl>
</div>
<div class="section" id="reboot">
<h2>Reboot<a class="headerlink" href="#reboot" title="Permalink to this headline">¶</a></h2>
<p>At this point, reboot so that changes can take effect (ssh server running, hardware drivers get loaded into kernel, etc.). After the machine boots back up again, check that you are a member of the &#8216;iocard&#8217; and &#8216;dialout&#8217; groups.</p>
</div>
<div class="section" id="managing-fstab">
<h2>Managing fstab<a class="headerlink" href="#managing-fstab" title="Permalink to this headline">¶</a></h2>
<p>Entries in the fstab (file system table) detail information when you give the command <tt class="docutils literal"><span class="pre">mount</span> <span class="pre">$MOUNTPOINT</span></tt>, so that you don&#8217;t have to specify all the permissions, etc. explicitly every time you issue the mount command. We add 3 entries to fstab:</p>
<div class="highlight-python"><div class="highlight"><pre>/dev/sdb1 /storage        ext4    defaults 0       0
//project.eecs.berkeley.edu/carmena /backup cifs noauto,username=sgowda,domain=EECS,sec=ntlmssp,uid=localuser,dir_mode=0777,file_mode=0777 0 0
//10.0.0.13/PlexonData /storage/plexon  smbfs   user=arc,pass=c@rmena,uid=1000,gid=1000 0 0
</pre></div>
</div>
<p>The first specifies &#8216;/storage&#8217; as the mount-point for a second hard drive (/dev/sdb1 is the first partition on hard drive &#8216;b&#8217;). In our system, we run the operating system off a small solid-state drive (/dev/sda) and store data on a larger regular hard drive (/dev/sdb).</p>
<p>The second specifies how to mount the offsite backup. In this case, the protocol is CIFS.</p>
<p>The third entry specifies how to mount the data directory of the neural recording PC (in our case, this is a Windows PC provided by plexon). You may wish to also assign a different IP address to the neural recording PC. This line also will not work until you set up DHCP in the next step</p>
</div>
<div class="section" id="rsync-crontab">
<h2>rsync &amp; crontab<a class="headerlink" href="#rsync-crontab" title="Permalink to this headline">¶</a></h2>
<p>rsync is a unix command-line utility which can synchronize two folders (including remote folders). This funcitonality is similar to how cloud storage services (like Dropbox) operate, but for a single user. An example rsync command:</p>
<div class="highlight-python"><div class="highlight"><pre>rsync -rlt --partial /home/lab/code/bmi3d/db/db.sql /backup/exorig/db_exorig.sql
rsync -rlt --exclude=plexonlocal --exclude=video --partial /storage/ /backup/exorig/
</pre></div>
</div>
<p>These two commands force <tt class="docutils literal"><span class="pre">/backup/exorig/db_exorig.sql</span></tt> to match the <tt class="docutils literal"><span class="pre">db.sql</span></tt> which is modified by the rig, and also to synchronize <tt class="docutils literal"><span class="pre">/storage</span></tt> with <tt class="docutils literal"><span class="pre">/backup</span></tt>, where in our earlier modified <tt class="docutils literal"><span class="pre">/etc/fstab</span></tt>, <tt class="docutils literal"><span class="pre">/backup</span></tt> is an off-site storage directory which we network mounted.</p>
<p>You can used the <tt class="docutils literal"><span class="pre">crontab</span></tt> utility to automatically run rsync commands at a certain time of the day, to make the synchronization automatic without human intervention.</p>
</div>
</div>
<div class="section" id="network-configuration">
<h1>Network configuration<a class="headerlink" href="#network-configuration" title="Permalink to this headline">¶</a></h1>
<p>In our setup, the main PC (named &#8216;arc&#8217;) has two network cards. One faces the outside internet (interface eth0) and the other is used for communicating with other devices through a local switch (interface eth1). Other devices might include the neural recording PC, an eyetracker, a motiontracker, etc. In order for all these devices to talk to each other, they must all have a unique IP on the local subnet assigned by a DHCP server running on the main computer, arc.</p>
<div class="section" id="dhcp">
<h2>DHCP<a class="headerlink" href="#dhcp" title="Permalink to this headline">¶</a></h2>
<p>First, we specify eth1 as our DHCP server interface by editing /etc/default/isc-dhcp-server to read:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">INTERFACES</span><span class="o">=</span><span class="s">&quot;eth1&quot;</span>
</pre></div>
</div>
<p>The default for the INTERFACES line should be an empty string</p>
<dl class="docutils">
<dt>Second, we have to configure /etc/network/interfaces to use eth0 as the &#8220;outward&#8221; facing interface and eth1 as the internal interface. For eth0, we add the following lines to /etc/network/interfaces::</dt>
<dd># The primary network interface
auto eth0
iface eth0 inet dhcp</dd>
</dl>
<p>which essentially tells it to ask some external DHCP server for a license for eth0. For eth1, where arc is acting as the server rather than the client, the configuration is slightly more complex:</p>
<div class="highlight-python"><div class="highlight"><pre># Set up the internal wired network
auto eth1
iface eth1 inet static
    address 10.0.0.1
    network 10.0.0.0
    netmask 255.255.255.0
    broadcast 10.0.0.255
</pre></div>
</div>
<p>If your two network configuration is the same as ours, you can simply run the command:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo cp $BMI3D/install/arc_interfaces /etc/network/interfaces
</pre></div>
</div>
<p>Third, we have to edit the DHCP configuration file, /etc/dhcp/dhcpd.conf. For each mac address on the internal network, we assign a name and an IP address to that machine in a static configuration (so that they&#8217;re always the same when the experiments are running). We add lines to declare the subnet IP space:</p>
<div class="highlight-python"><div class="highlight"><pre>subnet 10.0.0.0 netmask 255.255.255.0 {
  range 10.0.0.10 10.0.0.254;
  option routers 10.0.0.1;
}
</pre></div>
</div>
<p>and then the specific IP address for each machine, e.g. for the plexon PC below:</p>
<div class="highlight-python"><div class="highlight"><pre>host plexon {
    hardware ethernet b8:ac:6f:92:50:e1;
    fixed-address 10.0.0.13;
}
</pre></div>
</div>
<p>Now we restart the DHCP server (which should be running in the background automatically if you&#8217;ve rebooted the machine as specified above) with:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo service isc-dhcp-server restart
</pre></div>
</div>
<p>All the instructions above can also be automated by running the script $BMI3D/install/install_dhcp.sh. To force the windows computer to renew its DHCP lease and change IP address, run &#8220;ipconfig /release&#8221; followed by &#8220;ipconfig /renew&#8221; on the command line.</p>
<p>You may have to reboot the machine to make the DHCP server changes go into effect before continuing on to configure network address translation.</p>
</div>
<div class="section" id="nat">
<h2>NAT<a class="headerlink" href="#nat" title="Permalink to this headline">¶</a></h2>
<p>In our setup, the external internet is used only sparingly by the neural recording PC. So we would like to have some internet access but we don&#8217;t necessarily want to have a direct interface dedicated to external internet (cost, security, etc.). So we use network address translation (NAT) to route internet traffic through the main experimental computer (arc). The configuration script used for arc was copied from the internet (<a class="reference external" href="https://help.ubuntu.com/community/Router">https://help.ubuntu.com/community/Router</a>). To execute it, run:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo $BMI3D/install/arc_install_nat.sh
</pre></div>
</div>
<p>At this point, you should be able to get external internet on the Windows PC. You may need to renew the DHCP license to do so.</p>
<p>NOTE: every time you add a new machine to the dchp config file, it seems that you must re-run the NAT setup script. Otherwise the new machine will get an
IP address from DHCP but will not be able to reach the outside internet.</p>
</div>
<div class="section" id="setting-up-a-gateway-machine">
<h2>Setting up a gateway machine<a class="headerlink" href="#setting-up-a-gateway-machine" title="Permalink to this headline">¶</a></h2>
<p>You may not want to allow direct SSH to your rig machine and instead force ssh traffic through a gateway machine. This is a great idea for security, since if your rig machine is compromised, you&#8217;ll may have to redo many of the steps above (and you might lose data!). But making a gateway means that copying files over to your analysis machine is annoying, since you basically have to execute twice as many <tt class="docutils literal"><span class="pre">scp</span></tt> commands. A nice alternative is an SSH tunnel that you can create on your analysis machine. If &#8216;portal&#8217; is the gateway and &#8216;nucleus&#8217; is the rig machine, then on you analysis machine you can execute the commands</p>
<div class="code bash highlight-python"><div class="highlight"><pre>kill `ps aux | grep 8000 | grep ssh | tr -s &#39; &#39; | cut -d &#39; &#39; -f 2`
kill `ps aux | grep 22 | grep ssh | tr -s &#39; &#39; | cut -d &#39; &#39; -f 2`
ssh -f -N -L 43002:nucleus:8000 portal
ssh -f -N -L 43001:nucleus:22 portal
</pre></div>
</div>
<p>This forwards port 8000 (for Django) to local port 43002 and port 22 (for ssh) to local port 43001. Then in your local ssh config file (~/.ssh/config),</p>
<blockquote>
<div><dl class="docutils">
<dt>Host nucleus_tunnel</dt>
<dd>HostName localhost
Port 43001
User helene</dd>
</dl>
</div></blockquote>
<p>Then any subsequent ssh/scp commands can use &#8216;nucleus_tunnel&#8217; in place of &#8216;nucleus&#8217; and just work as if they were on the same local network as &#8216;nucleus&#8217;. Similarly, you can remotely view the web interface by pointing your browser to localhost:43002</p>
</div>
</div>
<div class="section" id="peripheral-devices">
<h1>Peripheral devices<a class="headerlink" href="#peripheral-devices" title="Permalink to this headline">¶</a></h1>
<div class="section" id="testing-the-nidaq-interface">
<h2>Testing the NIDAQ interface<a class="headerlink" href="#testing-the-nidaq-interface" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">the NIDAQ card is deprecated!</p>
</div>
<p>The NIDAQ card uses the &#8216;comedi&#8217; device driver for linux, written in C. There is a wrapper for the library, pycomedi. Unfortunately we don&#8217;t seem to have properly configured things, so initializing the device doesn&#8217;t seem to work form python. Instead, the C version of the code must be used for initializing the device, after which the IO lanes can be read/written from python.</p>
<p><strong>Setting up the operating system</strong></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This step is only if you are using the NI PCI 6503 card. If not, skip it! Or if you need a particular kernel version for a different reason, you should be able to adapt these instructions</p>
</div>
<p>The bmi3d software is written primarily in Python. It has
primarily been tested in operation in Ubuntu linux, though some testing has been
done for CentOS 6. Ubuntu is substantially easier to set up, and these instructions
are geared toward an Ubuntu setup.</p>
<p>If you are using the NI6503 card to send digital data, we recommend specifically
using Ubuntu 12.04 LTS with kernel version 3.2.x-x. The version of
Ubuntu may not be very important, but the specific kernel version
is important <em>if you are using the NI6503 card to send digital data</em>.
If you are using an arduino microcontroller, you can skip this step.</p>
<p>The instructions below are intended for a clean install of Ubuntu. If
you do not do this on a clean installation, you must be careful with
the instructions below, which actually remove later versions of the kernel.
Although multiple versions of the kernel can coexist on the same system
if you use a bootloader such as grub, we have chosen to keep only
one version so as to avoid the possiblity in a deployment environment
of accidentally rebooting the machine and using the wrong version.</p>
<p>When installing Ubuntu, either create the installer with the correct
kernel version (not sure exactly how to do this, but of course at some
point the default installer was the version of the kernel we want) OR
install any later version of the kernel and downgrade the image. Rough
instructions are below downgrade the kernel image:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo apt-get install linux-headers-3.2.0-60-generic
sudo apt-get install linux-image-3.2.0-60-generic
sudo apt-get remove --purge linux-image-3.11.0-*
sudo apt-get remove --purge linux-headers-3.11.0-*
sudo apt-get install grub

# Update the bootloader; a bootloader may not be strictly necessary..
sudo grub-mkconfig -o /boot/grub/grub.cfg
sudo update-grub
</pre></div>
</div>
<p>These can also be found in the script $BMI3D/install/ubuntu_kernel_mod.sh.
Of course if you install with a kernel version other than 3.11.0, make
the appropriate replacement. You may have to run the purge commands more than
once if apt-get decides to install another kernel version automatically when
you remove the one you installed.</p>
<p>After checking in /boot/grub/grub.cfg that only kernel version 3.2.0-60 appears
in the bootloader menu, restart the machine so that the kernel changes take
effect.</p>
</div>
<div class="section" id="renaming-serial-ports">
<h2>Renaming serial ports<a class="headerlink" href="#renaming-serial-ports" title="Permalink to this headline">¶</a></h2>
<p>Certain peripheral devices make use of serial ports. Linux assigns somewhat random names to serial ports, which can change based on the order in which they&#8217;re plugged in. This makes it annoying to write the name of the serial port in the code.</p>
<p>These instructions help automatically rename serial ports: <a class="reference external" href="http://hintshop.ludvig.co.nz/show/persistent-names-usb-serial-devices/">http://hintshop.ludvig.co.nz/show/persistent-names-usb-serial-devices/</a></p>
</div>
</div>
<div class="section" id="running-the-first-tasks">
<h1>Running the first tasks<a class="headerlink" href="#running-the-first-tasks" title="Permalink to this headline">¶</a></h1>
<div class="section" id="running-the-django-server-for-the-first-time">
<h2>Running the Django server for the first time<a class="headerlink" href="#running-the-django-server-for-the-first-time" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>First, for some reason the matplotlib configuration file directory appears to be owned by root when making these instructions. The Django software needs matplotlib for some reason, so we change ownership of the directorh $HOME/.matplotlib back to the user, which is what it should be anyway::</dt>
<dd>sudo chown -R $USER ~/.matplotlib</dd>
</dl>
<p>Before running the experiment server, we have to create an empty database file. This is done by:</p>
<div class="highlight-python"><div class="highlight"><pre>cd $BMI3D/db
python manage.py syncdb
</pre></div>
</div>
<p>You will be prompted to create a superuser account for the database. Since our database will never be publicly visible (it&#8217;s more for record-keeping purposes than for building a website, which is what Django was intended for), there&#8217;s no need to worry too much about password security here.</p>
<p>To fire up the experimental rig, from the same &#8216;db&#8217; directory run:</p>
<div class="highlight-python"><div class="highlight"><pre>./runserver.sh
</pre></div>
</div>
<p>Then, from your browser, point to the address:</p>
<div class="highlight-python"><div class="highlight"><pre>localhost:8000
</pre></div>
</div>
</div>
<div class="section" id="running-a-simple-task">
<h2>Running a simple task<a class="headerlink" href="#running-a-simple-task" title="Permalink to this headline">¶</a></h2>
<p>From the browser, start the visual_feedback_multi task. Make sure to check the &#8216;autostart&#8217; and &#8216;saveHDF&#8217; features (otherwise the task will not run), select the &#8216;centerout_2D_discerete&#8217; generator from the Sequence menu, and select &#8216;CursorPlant&#8217; in the arm_class.</p>
</div>
<div class="section" id="configuration-files">
<h2>Configuration files<a class="headerlink" href="#configuration-files" title="Permalink to this headline">¶</a></h2>
<p>config : rig-specific configurations, e.g., data paths, neural recording system.
tasklist : List of tasks which can be started through the web interface
featurelist : list of features which can be selected through the web interface
bmilist :</p>
<blockquote>
<div>type of decoding algorithm, plant type, signal source (spike counts, lfp)
BMI menu only shows up for task classes which are marked as bmi, with the task class attribute is_bmi_seed</div></blockquote>
</div>
<div class="section" id="automatic-testing">
<h2>Automatic testing<a class="headerlink" href="#automatic-testing" title="Permalink to this headline">¶</a></h2>
<p>[(]this section is still incomplete]
Use the Ubuntu GUI to add a &#8220;testing&#8221; user
As the testing user
- clone the BMI3D repo
- run make_config.py; make sure data paths are correct; other options don&#8217;t matter
- install the robitics toolbox and add to python path
- make sure group ownership and file permissions allow the testing user to read data files
- mkdir $BMI3D/test_output</p>
</div>
<div class="section" id="configuring-ipython">
<h2>Configuring ipython<a class="headerlink" href="#configuring-ipython" title="Permalink to this headline">¶</a></h2>
<p>For quick analyses from the command line, it can be useful to have ipython pre-loaded with some commonly used modules. For complete instructions on how to set this up, see <a class="reference external" href="https://ipython.org/ipython-doc/dev/config/intro.html">https://ipython.org/ipython-doc/dev/config/intro.html</a>. You can make a default ipython profile by executing the shell command:</p>
<div class="highlight-python"><div class="highlight"><pre>ipython profile create
</pre></div>
</div>
<p>Then edit the newly create configuration file to look something like</p>
<dl class="docutils">
<dt>c.InteractiveShellApp.exec_lines = [</dt>
<dd>&#8220;from db import dbfunctions as dbfn&#8221;,
&#8220;from db.tracker import models&#8221;,
&#8220;import numpy as np&#8221;,
&#8220;import matplotlib.pyplot as plt&#8221;,</dd>
</dl>
<p>]</p>
</div>
<div class="section" id="graphics">
<h2>Graphics<a class="headerlink" href="#graphics" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This step is only needed if (1) you have an nvidia graphics card and (2) the 3-D stereo graphics do not render properly. If they do render okay, then don&#8217;t change the driver!</p>
</div>
<p>After downgrading the kernel on arc, the graphics are all messed up. The second monitor isn&#8217;t detected and there&#8217;s a weird border around the first screen. It seems like this has something to do with the kernel version change (i.e., the driver was kernel-version specific). So we do a:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo apt-get install nvidia-331
</pre></div>
</div>
<p>where at the time of this writing, &#8220;331&#8221; was the latest stable version of the library available in the standard Ubuntu repository. At some point during the installation says it&#8217;s &#8220;Building initial module for 3.2.0-60-generic&#8221;. After installing, we reboot again. After reboot, the second monitor has things displayed on it again and everything looks normal!</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Installation</a><ul>
<li><a class="reference internal" href="#downloading-the-software">Downloading the software</a></li>
<li><a class="reference internal" href="#library-dependencies">Library dependencies</a></li>
<li><a class="reference internal" href="#directory-structure">Directory structure</a></li>
<li><a class="reference internal" href="#configuring-the-ubuntu-package-manager">Configuring the Ubuntu package manager</a></li>
<li><a class="reference internal" href="#install-apt-get-dependencies">Install apt-get dependencies</a></li>
<li><a class="reference internal" href="#install-python-dependencies">Install Python dependencies</a></li>
<li><a class="reference internal" href="#additional-source-code">Additional source code</a></li>
<li><a class="reference internal" href="#udev-and-groups">udev and groups</a></li>
<li><a class="reference internal" href="#path-configuration">Path configuration</a></li>
<li><a class="reference internal" href="#reboot">Reboot</a></li>
<li><a class="reference internal" href="#managing-fstab">Managing fstab</a></li>
<li><a class="reference internal" href="#rsync-crontab">rsync &amp; crontab</a></li>
</ul>
</li>
<li><a class="reference internal" href="#network-configuration">Network configuration</a><ul>
<li><a class="reference internal" href="#dhcp">DHCP</a></li>
<li><a class="reference internal" href="#nat">NAT</a></li>
<li><a class="reference internal" href="#setting-up-a-gateway-machine">Setting up a gateway machine</a></li>
</ul>
</li>
<li><a class="reference internal" href="#peripheral-devices">Peripheral devices</a><ul>
<li><a class="reference internal" href="#testing-the-nidaq-interface">Testing the NIDAQ interface</a></li>
<li><a class="reference internal" href="#renaming-serial-ports">Renaming serial ports</a></li>
</ul>
</li>
<li><a class="reference internal" href="#running-the-first-tasks">Running the first tasks</a><ul>
<li><a class="reference internal" href="#running-the-django-server-for-the-first-time">Running the Django server for the first time</a></li>
<li><a class="reference internal" href="#running-a-simple-task">Running a simple task</a></li>
<li><a class="reference internal" href="#configuration-files">Configuration files</a></li>
<li><a class="reference internal" href="#automatic-testing">Automatic testing</a></li>
<li><a class="reference internal" href="#configuring-ipython">Configuring ipython</a></li>
<li><a class="reference internal" href="#graphics">Graphics</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Welcome to BMI3D&#8217;s documentation!</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="prereqs.html"
                        title="next chapter">Assumed Python knowledge</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/install.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="prereqs.html" title="Assumed Python knowledge"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to BMI3D’s documentation!"
             >previous</a> |</li>
        <li><a href="index.html">BMI3D 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, James Gao; 2015, James Gao, Helene Moorman, Suraj Gowda, Siddharth Dangi.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>